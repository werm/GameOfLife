(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.GameOfLife = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
var Grid = {
  dimensions: {},
  rows: [],

  init: function init(w, h) {
    Grid.dimensions.width = w;
    Grid.dimensions.height = h;

    for (var i = 0; i < h; i++) {
      var row = [];
      for (var j = 0; j < w; j++) {
        row.push(Cell.create(i, j));
      }
      Grid.rows.push(row);
    }

    return Grid.rows;
  },

  build: function build() {
    var gameBoard = document.querySelector('#gol');
    gameBoard.innerHTML = '';
    Grid.rows.forEach(function (row) {
      var gridRow = document.createElement('tr');
      row.forEach(function (cell, i) {
        Cell.examine(cell);
        var celly = document.createElement('td');
        celly.classList.add('cell', 'cell-' + cell.x + cell.y);
        if (cell.y === 0) {
          celly.classList.add('end-row');
        }
        if (cell.live) {
          celly.classList.add('alive');
        }
        gridRow.appendChild(celly);
      });
      gameBoard.appendChild(gridRow);
    });
  },

  traverse: function traverse(fn) {
    var x, y;
    var context = { stop: false };
    outer: for (y = 0; y < Grid.dimensions.height; y++) {
      for (x = 0; x < Grid.dimensions.width; x++) {
        fn(context, Grid.rows[y][x], x, y);
        if (context.stop) {
          break outer;
        }
      }
    }
  },

  tick: function tick() {

    Grid.traverse(function (ctxt, cell) {
      Cell.examine(cell);
    });

    Grid.traverse(function (ctxt, cell) {
      Cell.update(cell);
    });

    Grid.build();
  }
};

var Cell = {
  create: function create(x, y) {
    var cell = {};
    cell.x = x;
    cell.y = y;
    cell.live = Math.random() <= 0.5 ? true : false;
    cell.self = Cell;

    return cell;
  },

  get: function get(x, y) {
    return new Promise(function (resolve, reject) {
      Grid.rows.forEach(function (row) {
        row.forEach(function (cell, i) {
          if (cell.x === x && cell.y === y) {
            resolve(cell);
          }
        });
      });
      reject(new Error('No matching cell!'));
    });

    return targetCell;
  },

  examine: function examine(cell) {
    cell.liveNeighbors = 0;

    return Cell.checkNeighbors(cell, function (ctxt, neighbor) {
      if (neighbor.live) {
        cell.liveNeighbors++;
      }
    });
  },

  update: function update(cell) {
    var liveNeighbors = cell.liveNeighbors;

    if (cell.live) {
      if (liveNeighbors <= 1 || liveNeighbors >= 4) {
        cell.live = false;
      }
    } else if (liveNeighbors === 3) {
      cell.live = true;
    }
    return cell;
  },

  checkNeighbors: function checkNeighbors(cell, fn) {
    var x, y, n;
    var context = { stop: false };

    check: for (y = Math.max(0, cell.y - 1); y <= Math.min(Grid.dimensions.height - 1, cell.y + 1); y++) {
      for (x = Math.max(0, cell.x - 1); x <= Math.min(Grid.dimensions.width - 1, cell.x + 1); x++) {
        if (x !== cell.x || y !== cell.y) {
          var neighbor = Grid.rows[y][x];

          fn(context, neighbor);
          if (context.stop) {
            break check;
          }
        }
      }
    }
  }

};

exports['default'] = { Grid: Grid, Cell: Cell };
module.exports = exports['default'];

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvY3dlcm1lcnQvUHJvamVjdHMvR2FtZU9mTGlmZS9zcmMvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQ0FBLElBQU0sSUFBSSxHQUFHO0FBQ1gsWUFBVSxFQUFFLEVBQUU7QUFDZCxNQUFJLEVBQUUsRUFBRTs7QUFFUixNQUFJLEVBQUEsY0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFO0FBQ1QsUUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO0FBQzFCLFFBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQzs7QUFFM0IsU0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtBQUMxQixVQUFJLEdBQUcsR0FBRyxFQUFFLENBQUM7QUFDYixXQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO0FBQzFCLFdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztPQUM3QjtBQUNELFVBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0tBQ3JCOztBQUVELFdBQU8sSUFBSSxDQUFDLElBQUksQ0FBQztHQUNsQjs7QUFFRCxPQUFLLEVBQUEsaUJBQUc7QUFDTixRQUFJLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQy9DLGFBQVMsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO0FBQ3pCLFFBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQUMsR0FBRyxFQUFLO0FBQ3pCLFVBQUksT0FBTyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsSUFBSSxD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QUUsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtBQUNuRyxXQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO0FBQzNGLFlBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLEVBQUU7QUFDaEMsY0FBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzs7QUFFL0IsWUFBRSxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztBQUN0QixjQUFJLE9BQU8sQ0FBQyxJQUFJLEVBQUU7QUFDaEIsa0JBQU0sS0FBSyxDQUFDO1dBQ2I7U0FDRjtPQUNGO0tBQ0Y7R0FDRjs7Q0FFRixDQUFBOztxQkFFYyxFQUFFLElBQUksRUFBSixJQUFJLEVBQUUsSUFBSSxFQUFKLElBQUksRUFBRSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJjb25zdCBHcmlkID0ge1xuICBkaW1lbnNpb25zOiB7fSxcbiAgcm93czogW10sXG5cbiAgaW5pdCh3LCBoKSB7XG4gICAgR3JpZC5kaW1lbnNpb25zLndpZHRoID0gdztcbiAgICBHcmlkLmRpbWVuc2lvbnMuaGVpZ2h0ID0gaDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaDsgaSsrKSB7XG4gICAgICBsZXQgcm93ID0gW107XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHc7IGorKykge1xuICAgICAgICByb3cucHVzaChDZWxsLmNyZWF0ZShpLCBqKSk7XG4gICAgICB9XG4gICAgICBHcmlkLnJvd3MucHVzaChyb3cpO1xuICAgIH1cblxuICAgIHJldHVybiBHcmlkLnJvd3M7XG4gIH0sXG5cbiAgYnVpbGQoKSB7XG4gICAgbGV0IGdhbWVCb2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnb2wnKTtcbiAgICBnYW1lQm9hcmQuaW5uZXJIVE1MID0gJyc7XG4gICAgR3JpZC5yb3dzLmZvckVhY2goKHJvdykgPT4ge1xuICAgICAgbGV0IGdyaWRSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuICAgICAgcm93LmZvckVhY2goKGNlbGwsIGkpID0+IHtcbiAgICAgICAgQ2VsbC5leGFtaW5lKGNlbGwpXG4gICAgICAgIGxldCBjZWxseSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJylcbiAgICAgICAgY2VsbHkuY2xhc3NMaXN0LmFkZCgnY2VsbCcsIGBjZWxsLSR7Y2VsbC54fSR7Y2VsbC55fWApO1xuICAgICAgICBpZiAoY2VsbC55ID09PSAwKSB7XG4gICAgICAgICAgY2VsbHkuY2xhc3NMaXN0LmFkZCgnZW5kLXJvdycpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjZWxsLmxpdmUpIHtcbiAgICAgICAgICBjZWxseS5jbGFzc0xpc3QuYWRkKCdhbGl2ZScpO1xuICAgICAgICB9XG4gICAgICAgIGdyaWRSb3cuYXBwZW5kQ2hpbGQoY2VsbHkpO1xuICAgICAgfSlcbiAgICAgIGdhbWVCb2FyZC5hcHBlbmRDaGlsZChncmlkUm93KTtcbiAgICB9KVxuICB9LFxuXG4gIHRyYXZlcnNlKGZuKSB7XG4gICAgdmFyIHgsIHk7XG4gICAgdmFyIGNvbnRleHQgPSB7IHN0b3A6IGZhbHNlIH07XG4gICAgb3V0ZXI6IGZvciAoeSA9IDA7IHkgPCBHcmlkLmRpbWVuc2lvbnMuaGVpZ2h0OyB5KyspIHtcbiAgICAgIGZvciAoeCA9IDA7IHggPCBHcmlkLmRpbWVuc2lvbnMud2lkdGg7IHgrKykge1xuICAgICAgICBmbihjb250ZXh0LCBHcmlkLnJvd3NbeV1beF0sIHgsIHkpO1xuICAgICAgICBpZiAoY29udGV4dC5zdG9wKSB7XG4gICAgICAgICAgYnJlYWsgb3V0ZXI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgdGljaygpIHtcblxuICAgIEdyaWQudHJhdmVyc2UoKGN0eHQsIGNlbGwpID0+IHtcbiAgICAgIENlbGwuZXhhbWluZShjZWxsKTtcbiAgICB9KTtcblxuICAgIEdyaWQudHJhdmVyc2UoKGN0eHQsIGNlbGwpID0+IHtcbiAgICAgIENlbGwudXBkYXRlKGNlbGwpO1xuICAgIH0pO1xuXG4gICAgR3JpZC5idWlsZCgpO1xuXG4gIH1cbn1cblxuY29uc3QgQ2VsbCA9IHtcbiAgY3JlYXRlKHgsIHkpIHtcbiAgICBsZXQgY2VsbCA9IHt9O1xuICAgIGNlbGwueCA9IHg7XG4gICAgY2VsbC55ID0geTtcbiAgICBjZWxsLmxpdmUgPSBNYXRoLnJhbmRvbSgpIDw9IDAuNSA/IHRydWUgOiBmYWxzZTtcbiAgICBjZWxsLnNlbGYgPSBDZWxsO1xuXG4gICAgcmV0dXJuIGNlbGw7XG4gIH0sXG5cbiAgZ2V0KHgsIHkpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgR3JpZC5yb3dzLmZvckVhY2goKHJvdykgPT4ge1xuICAgICAgICByb3cuZm9yRWFjaCgoY2VsbCwgaSkgPT4ge1xuICAgICAgICAgIGlmIChjZWxsLnggPT09IHggJiYgY2VsbC55ID09PSB5KSB7XG4gICAgICAgICAgICByZXNvbHZlKGNlbGwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHJlamVjdChuZXcgRXJyb3IoJ05vIG1hdGNoaW5nIGNlbGwhJykpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRhcmdldENlbGw7XG4gIH0sXG5cbiAgZXhhbWluZShjZWxsKSB7XG4gICAgY2VsbC5saXZlTmVpZ2hib3JzID0gMDtcbiAgICBcbiAgICByZXR1cm4gQ2VsbC5jaGVja05laWdoYm9ycyhjZWxsLCAoY3R4dCwgbmVpZ2hib3IpID0+IHtcbiAgICAgIGlmIChuZWlnaGJvci5saXZlKSB7XG4gICAgICAgIGNlbGwubGl2ZU5laWdoYm9ycysrO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIHVwZGF0ZShjZWxsKSB7XG4gICAgbGV0IGxpdmVOZWlnaGJvcnMgPSBjZWxsLmxpdmVOZWlnaGJvcnM7XG5cbiAgICBpZiAoY2VsbC5saXZlKSB7XG4gICAgICBpZiAobGl2ZU5laWdoYm9ycyA8PSAxIHx8IGxpdmVOZWlnaGJvcnMgPj0gNCkge1xuICAgICAgICBjZWxsLmxpdmUgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9IGVsc2VcbiAgICBpZiAobGl2ZU5laWdoYm9ycyA9PT0gMykge1xuICAgICAgY2VsbC5saXZlID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGNlbGw7XG4gIH0sXG5cbiAgY2hlY2tOZWlnaGJvcnMoY2VsbCwgZm4pIHtcbiAgICB2YXIgeCwgeSwgbjtcbiAgICB2YXIgY29udGV4dCA9IHsgc3RvcDogZmFsc2UgfTtcblxuICAgIGNoZWNrOiBmb3IgKHkgPSBNYXRoLm1heCgwLCBjZWxsLnkgLSAxKTsgeSA8PSBNYXRoLm1pbihHcmlkLmRpbWVuc2lvbnMuaGVpZ2h0IC0gMSwgY2VsbC55ICsgMSk7IHkrKykge1xuICAgICAgZm9yICh4ID0gTWF0aC5tYXgoMCwgY2VsbC54IC0gMSk7IHggPD0gTWF0aC5taW4oR3JpZC5kaW1lbnNpb25zLndpZHRoIC0gMSwgY2VsbC54ICsgMSk7IHgrKykge1xuICAgICAgICBpZiAoeCAhPT0gY2VsbC54IHx8IHkgIT09IGNlbGwueSkge1xuICAgICAgICAgIHZhciBuZWlnaGJvciA9IEdyaWQucm93c1t5XVt4XTtcbiAgICAgICAgICBcbiAgICAgICAgICBmbihjb250ZXh0LCBuZWlnaGJvcik7XG4gICAgICAgICAgaWYgKGNvbnRleHQuc3RvcCkge1xuICAgICAgICAgICAgYnJlYWsgY2hlY2s7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgeyBHcmlkLCBDZWxsIH07Il19
